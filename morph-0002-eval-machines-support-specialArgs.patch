From 633852a936b8ba964928140f4e590a519735e16e Mon Sep 17 00:00:00 2001
From: Dusk Banks <me@bb010g.com>
Date: Tue, 8 Mar 2022 03:47:13 -0800
Subject: [PATCH 2/2] eval-machines: support `specialArgs`

---
 data/eval-machines.nix | 9 ++++++++-
 1 file changed, 8 insertions(+), 1 deletion(-)

diff --git a/data/eval-machines.nix b/data/eval-machines.nix
index 41e2a22..041ac57 100644
--- a/data/eval-machines.nix
+++ b/data/eval-machines.nix
@@ -6,7 +6,12 @@ let
   nw             = network.network;
   nwPkgs         = nw.pkgs or {};
   nwLib          = nw.lib or nwPkgs.lib or (import <nixpkgs/lib>);
-  nwEvalConfig   = nw.evalConfig or ((nwPkgs.path or <nixpkgs>) + "/nixos/lib/eval-config.nix");
+  nwEvalConfig   = let
+                     nwEvalConfig' =
+                       nw.evalConfig or ((nwPkgs.path or <nixpkgs>) + "/nixos/lib/eval-config.nix");
+                   in
+                   if nwLib.isFunction nwEvalConfig' then nwEvalConfig' else import nwEvalConfig';
+  nwSpecialArgs  = nw.specialArgs or {};
   nwRunCommand   = nw.runCommand or nwPkgs.runCommand or ((import <nixpkgs> {}).runCommand);
 in
 
@@ -56,6 +61,7 @@ in rec {
         check = false;
         nodes = uncheckedNodes;
       };
+      specialArgs = nwSpecialArgs;
     }) networkMachines;
 
   # Compute the definitions of the machines.
@@ -66,6 +72,7 @@ in rec {
         check = true;
         nodes = uncheckedNodes;
       };
+      specialArgs = nwSpecialArgs;
     }) networkMachines;
 
   deploymentInfoModule = {
-- 
2.35.1

